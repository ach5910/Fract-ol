/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   mandelbrot.c                                       :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: ahunt <marvin@42.fr>                       +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2017/01/03 23:00:39 by ahunt             #+#    #+#             */
/*   Updated: 2017/01/03 23:00:42 by ahunt            ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include "fractol.h"

// int rainbow_squancher[256] ={
// 0xFF0005, 0xFE1100, 0xFE2900, 0xFE4100, 
// 0xFD5800, 0xFD7000, 0xFD8700, 0xFD9F00, 
// 0xFCB600, 0xFCCE00, 0xFCE500, 0xFBFB00, 
// 0xE3FB00, 0xCBFB00, 0xB4FB00, 0x9CFA00, 
// 0x85FA00, 0x6DFA00, 0x56F900, 0x3FF900, 
// 0x27F900, 0x10F900, 0x00F808, 0x00F81F, 
// 0x00F836, 0x00F74D, 0x00F764, 0x00F77B, 
// 0x00F791, 0x00F6A8, 0x00F6BF, 0x01F6D6, 
// 0x01F5EC, 0x01E7F5, 0x01D0F5, 0x01B9F5, 
// 0x01A2F4, 0x018CF4, 0x0175F4, 0x015EF3, 
// 0x0147F3, 0x0131F3, 0x011AF3, 0x0104F2, 
// 0x1501F2, 0x2B01F2, 0x4201F1, 0x5801F1, 
// 0x6E01F1, 0x8501F0, 0x9B01F0, 0xB101F0, 
// 0xC701F0, 0xDD01EF, 0xEF01EB, 0xEF01D5, 
// 0xEF01BF, 0xEE01A8, 0xEE0192, 0xEE017C, 
// 0xED0166, 0xED0150, 0xED0139, 0xED0123,
// 0xFF0005, 0xFE1100, 0xFE2900, 0xFE4100, 
// 0xFD5800, 0xFD7000, 0xFD8700, 0xFD9F00, 
// 0xFCB600, 0xFCCE00, 0xFCE500, 0xFBFB00, 
// 0xE3FB00, 0xCBFB00, 0xB4FB00, 0x9CFA00, 
// 0x85FA00, 0x6DFA00, 0x56F900, 0x3FF900, 
// 0x27F900, 0x10F900, 0x00F808, 0x00F81F, 
// 0x00F836, 0x00F74D, 0x00F764, 0x00F77B, 
// 0x00F791, 0x00F6A8, 0x00F6BF, 0x01F6D6, 
// 0x01F5EC, 0x01E7F5, 0x01D0F5, 0x01B9F5, 
// 0x01A2F4, 0x018CF4, 0x0175F4, 0x015EF3, 
// 0x0147F3, 0x0131F3, 0x011AF3, 0x0104F2, 
// 0x1501F2, 0x2B01F2, 0x4201F1, 0x5801F1, 
// 0x6E01F1, 0x8501F0, 0x9B01F0, 0xB101F0, 
// 0xC701F0, 0xDD01EF, 0xEF01EB, 0xEF01D5, 
// 0xEF01BF, 0xEE01A8, 0xEE0192, 0xEE017C, 
// 0xED0166, 0xED0150, 0xED0139, 0xED0123,
// 0xFF0005, 0xFE1100, 0xFE2900, 0xFE4100, 
// 0xFD5800, 0xFD7000, 0xFD8700, 0xFD9F00, 
// 0xFCB600, 0xFCCE00, 0xFCE500, 0xFBFB00, 
// 0xE3FB00, 0xCBFB00, 0xB4FB00, 0x9CFA00, 
// 0x85FA00, 0x6DFA00, 0x56F900, 0x3FF900, 
// 0x27F900, 0x10F900, 0x00F808, 0x00F81F, 
// 0x00F836, 0x00F74D, 0x00F764, 0x00F77B, 
// 0x00F791, 0x00F6A8, 0x00F6BF, 0x01F6D6, 
// 0x01F5EC, 0x01E7F5, 0x01D0F5, 0x01B9F5, 
// 0x01A2F4, 0x018CF4, 0x0175F4, 0x015EF3, 
// 0x0147F3, 0x0131F3, 0x011AF3, 0x0104F2, 
// 0x1501F2, 0x2B01F2, 0x4201F1, 0x5801F1, 
// 0x6E01F1, 0x8501F0, 0x9B01F0, 0xB101F0, 
// 0xC701F0, 0xDD01EF, 0xEF01EB, 0xEF01D5, 
// 0xEF01BF, 0xEE01A8, 0xEE0192, 0xEE017C, 
// 0xED0166, 0xED0150, 0xED0139, 0xED0123,
// 0xFF0005, 0xFE1100, 0xFE2900, 0xFE4100, 
// 0xFD5800, 0xFD7000, 0xFD8700, 0xFD9F00, 
// 0xFCB600, 0xFCCE00, 0xFCE500, 0xFBFB00, 
// 0xE3FB00, 0xCBFB00, 0xB4FB00, 0x9CFA00, 
// 0x85FA00, 0x6DFA00, 0x56F900, 0x3FF900, 
// 0x27F900, 0x10F900, 0x00F808, 0x00F81F, 
// 0x00F836, 0x00F74D, 0x00F764, 0x00F77B, 
// 0x00F791, 0x00F6A8, 0x00F6BF, 0x01F6D6, 
// 0x01F5EC, 0x01E7F5, 0x01D0F5, 0x01B9F5, 
// 0x01A2F4, 0x018CF4, 0x0175F4, 0x015EF3, 
// 0x0147F3, 0x0131F3, 0x011AF3, 0x0104F2, 
// 0x1501F2, 0x2B01F2, 0x4201F1, 0x5801F1, 
// 0x6E01F1, 0x8501F0, 0x9B01F0, 0xB101F0, 
// 0xC701F0, 0xDD01EF, 0xEF01EB, 0xEF01D5, 
// 0xEF01BF, 0xEE01A8, 0xEE0192, 0xEE017C, 
// 0xED0166, 0xED0150, 0xED0139, 0xED0123};

int mandelbrot(t_env *e, float r, float c_a, float c_b)
{
	int n;
	float a;
	float o_a;
	float b;
	float o_b;
	
	n = 0;
	a = 0;
	b = 0;
	while (n < e->max_iterations)
	{
		o_a = a * a - b * b;
		o_b = 2 * a * b;
		a = o_a + c_a;
		b = o_b + c_b;
		if (a * a + b * b > 4)
			break ;
		n++;
	}
	return (n);	
}
void draw_m(t_env *e)
{
	int i;
	int j;
	int p;
	int ret;
	float c_a;
	float c_b;
	int color;
	float r;
	
	r = sqrt(pow(W_2 / 2, 2) + pow(H_2 / 2, 2));
	j = 0;
	p = 0;
	while (j < H_2)
	{
		i = 0;
		while (i < W_2)
		{
			c_a =  (i - W_2 / 2) / (W_2 / 2 * e->zoom) + e->move_x ;
			c_b = (j - H_2 / 2) / (H_2 / 2 * e->zoom) + e->move_y ;
			if ((ret = mandelbrot(e, r, c_a, c_b)) == e->max_iterations)
				color = 0;
			else
			{
				color = e->color_map[(int)((ret * 64 * e->c_iter / e->max_iterations)) % 64];
			}
			// color = sqrt(pow(i - WIDTH / 2, 2) + pow(j - HEIGHT / 2, 2)) * 256 / r;
			// color = dusk[color % 256];
			p = (i * 4) + (j * e->img_2->size_line);
			e->img_2->data[p] = color & 0xFF;
			e->img_2->data[++p] = (color >> 8) & 0xFF;
			e->img_2->data[++p] = (color >> 16) & 0xFF;
			i++;
		}
		j++;
	}
	i = mlx_put_image_to_window(e->mlx, e->win_2, e->img_2->i_ptr, 0, 0);
	mlx_destroy_image(e->mlx, e->img_2->i_ptr);
	e->img_2->i_ptr = mlx_new_image(e->mlx, W_2, H_2);
}

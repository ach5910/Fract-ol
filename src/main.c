/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   main.c                                             :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: ahunt <marvin@42.fr>                       +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2016/12/03 20:47:44 by ahunt             #+#    #+#             */
/*   Updated: 2016/12/03 20:47:53 by ahunt            ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include "fractol.h"
#include <stdio.h>
int dawn[256] ={
	0xffffc3, 0xffffc2, 0xffffc1, 0xffffbf, 
	0xffffbe, 0xffffbd, 0xffffbc, 0xffffbb, 
	0xffffba, 0xffffb9, 0xffffb8, 0xffffb7, 
	0xffffb6, 0xffffb5, 0xffffb3, 0xffffb2, 
	0xffffb1, 0xffffb0, 0xffffaf, 0xffffae, 
	0xffffad, 0xffffac, 0xffffab, 0xffffaa, 
	0xffffa9, 0xffffa7, 0xffffa6, 0xffffa5, 
	0xffffa4, 0xffffa3, 0xffffa2, 0xffffa1, 
	0xffffa0, 0xffff9f, 0xffff9e, 0xffff9d, 
	0xffff9b, 0xffff9a, 0xffff99, 0xffff98, 
	0xffff97, 0xffff96, 0xffff95, 0xffff94, 
	0xffff93, 0xffff92, 0xffff91, 0xffff8f, 
	0xffff8e, 0xffff8d, 0xffff8c, 0xffff8b, 
	0xffff8a, 0xffff89, 0xffff88, 0xffff87, 
	0xffff86, 0xffff85, 0xffff83, 0xffff82, 
	0xffff81, 0xffff80, 0xffff7f, 0xffff7e, 
	0xffff7d, 0xfffd7d, 0xfffb7d, 0xfff97d, 
	0xfff77d, 0xfff57d, 0xfff27d, 0xfff17d, 
	0xffee7d, 0xffed7d, 0xffeb7d, 0xffe97d, 
	0xffe77d, 0xffe57e, 0xffe37e, 0xffe17e, 
	0xffdf7e, 0xffdd7e, 0xffdb7e, 0xffd97e, 
	0xffd77e, 0xffd57e, 0xffd37e, 0xffd17e, 
	0xffcf7e, 0xffcd7e, 0xffcb7e, 0xffc97e, 
	0xffc77e, 0xffc57e, 0xffc37e, 0xffc17e, 
	0xffbf7e, 0xffbd7e, 0xffbb7e, 0xffb97e, 
	0xffb77e, 0xffb57e, 0xffb37e, 0xffb17e, 
	0xffaf7e, 0xffad7e, 0xffab7e, 0xffa97e, 
	0xffa77e, 0xffa57e, 0xffa37e, 0xffa17e, 
	0xff9f7e, 0xff9d7e, 0xff9b7e, 0xff997e, 
	0xff977e, 0xff957e, 0xff937e, 0xff917f, 
	0xff8f7f, 0xff8d7f, 0xff8a7f, 0xff887f, 
	0xff867f, 0xff847f, 0xff837f, 0xff817f, 
	0xfe7e7f, 0xfc7d7f, 0xfa7a7f, 0xf8797f, 
	0xf6767f, 0xf4747f, 0xf2737f, 0xf0717f, 
	0xee6f7f, 0xec6d7f, 0xea6b7f, 0xe8697f, 
	0xe6667f, 0xe4647f, 0xe2627f, 0xe0617f, 
	0xde5e7f, 0xdc5d7f, 0xda5b7f, 0xd8597f, 
	0xd6577f, 0xd4547f, 0xd2537f, 0xd0517f, 
	0xce4f7f, 0xcc4d7f, 0xca4b7f, 0xc8497f, 
	0xc6467f, 0xc4447f, 0xc2427f, 0xc0407f, 
	0xbe3f7f, 0xbc3d7f, 0xba3b7f, 0xb8397f, 
	0xb6367f, 0xb4347f, 0xb2337f, 0xb0317f, 
	0xae2f7f, 0xab2c7f, 0xa92a7f, 0xa7287f, 
	0xa5277f, 0xa3257f, 0xa1227f, 0x9f217f, 
	0x9d1f7f, 0x9b1d7f, 0x991b7f, 0x97197f, 
	0x95167f, 0x93147f, 0x91127f, 0x8f117f, 
	0x8d0e7f, 0x8b0d7f, 0x890b7f, 0x87097f, 
	0x85067f, 0x83047f, 0x81027f, 0x7f007f, 
	0x7d007f, 0x7b007f, 0x79007f, 0x77007f, 
	0x75007f, 0x73007f, 0x71007f, 0x6f007f, 
	0x6d007f, 0x6b007f, 0x69007f, 0x67007f, 
	0x65007f, 0x63007f, 0x61007f, 0x5f007f, 
	0x5d007f, 0x5b007f, 0x59007f, 0x57007e, 
	0x55007e, 0x53007e, 0x52007e, 0x50007e, 
	0x4e007e, 0x4c007e, 0x4a007e, 0x48007e, 
	0x46007e, 0x44007e, 0x42007e, 0x40007e, 
	0x3e007e, 0x3c007e, 0x3a007e, 0x38007e, 
	0x36007e, 0x34007e, 0x32007e, 0x30007e, 
	0x2e007e, 0x2c007e, 0x2a007e, 0x28007e, 
	0x26007e, 0x24007e, 0x22007e, 0x20007e, 
	0x1e007e, 0x1c007e, 0x1a007e, 0x18007e, 
	0x16007e, 0x14007e, 0x12007e, 0x10007e, 
	0xe007e, 0xc007e, 0xa007e, 0x8007e, 
	0x6007e, 0x4007e, 0x2007e, 0x7e};

int red_blue[256] ={
	0x5f0000, 0x610000, 0x620000, 0x640000, 
	0x650000, 0x670000, 0x680000, 0x6a0000, 
	0x6b0000, 0x6d0000, 0x6e0000, 0x700000, 
	0x720000, 0x730000, 0x750000, 0x760000, 
	0x780000, 0x790000, 0x7b0000, 0x7c0000, 
	0x7e0000, 0x7f0000, 0x810000, 0x820000, 
	0x840000, 0x860000, 0x870000, 0x890000, 
	0x8a0000, 0x8c0000, 0x8d0000, 0x8f0000, 
	0x900000, 0x920000, 0x930000, 0x950000, 
	0x960000, 0x980000, 0x9a0000, 0x9b0000, 
	0x9d0000, 0x9e0000, 0xa00000, 0xa10000, 
	0xa30000, 0xa40000, 0xa60000, 0xa70000, 
	0xa90000, 0xaa0000, 0xac0000, 0xae0000, 
	0xaf0000, 0xb10000, 0xb20000, 0xb40000, 
	0xb50000, 0xb70000, 0xb80000, 0xba0000, 
	0xbb0000, 0xbd0000, 0xbe0000, 0xc00000, 
	0xc10101, 0xc20505, 0xc30909, 0xc40d0d, 
	0xc51111, 0xc61515, 0xc71919, 0xc81d1d, 
	0xc92121, 0xca2525, 0xcb2929, 0xcc2d2d, 
	0xcd3131, 0xce3535, 0xcf3939, 0xd03d3d, 
	0xd14141, 0xd24545, 0xd34949, 0xd44d4d, 
	0xd55151, 0xd65555, 0xd75959, 0xd85d5d, 
	0xd96161, 0xda6565, 0xdb6969, 0xdc6d6d, 
	0xdd7171, 0xde7575, 0xdf7979, 0xdf7d7d, 
	0xe08181, 0xe18585, 0xe28989, 0xe38d8d, 
	0xe49191, 0xe59595, 0xe69999, 0xe79d9d, 
	0xe8a1a1, 0xe9a5a5, 0xeaa9a9, 0xebadad, 
	0xecb1b1, 0xedb5b5, 0xeeb9b9, 0xefbdbd, 
	0xf0c1c1, 0xf1c5c5, 0xf2c9c9, 0xf3cdcd, 
	0xf4d1d1, 0xf5d5d5, 0xf6d9d9, 0xf7dddd, 
	0xf8e1e1, 0xf9e5e5, 0xfae9e9, 0xfbeded, 
	0xfcf1f1, 0xfdf5f5, 0xfef9f9, 0xfffdfd, 
	0xfdfdff, 0xf9f9fe, 0xf5f5fd, 0xf1f1fc, 
	0xededfb, 0xe9e9fa, 0xe5e5f9, 0xe1e1f8, 
	0xddddf7, 0xd9d9f6, 0xd5d5f5, 0xd1d1f4, 
	0xcdcdf3, 0xc9c9f2, 0xc5c5f1, 0xc1c1f0, 
	0xbdbdef, 0xb9b9ee, 0xb5b5ee, 0xb1b1ed, 
	0xadadec, 0xa9a9eb, 0xa5a5ea, 0xa1a1e9, 
	0x9d9de8, 0x9999e7, 0x9595e6, 0x9191e5, 
	0x8d8de4, 0x8989e3, 0x8585e2, 0x8181e1, 
	0x7d7de0, 0x7979df, 0x7575de, 0x7171dd, 
	0x6d6ddc, 0x6969dc, 0x6565db, 0x6161da, 
	0x5d5dd9, 0x5959d8, 0x5555d7, 0x5151d6, 
	0x4d4dd5, 0x4949d4, 0x4545d3, 0x4141d2, 
	0x3d3dd1, 0x3939d0, 0x3535cf, 0x3131ce, 
	0x2d2dcd, 0x2929cc, 0x2525cb, 0x2121cb, 
	0x1d1dca, 0x1919c9, 0x1515c8, 0x1111c7, 
	0xd0dc6, 0x909c5, 0x505c4, 0x101c3, 
	0xc2, 0xc0, 0xbe, 0xbd, 
	0xbb, 0xba, 0xb8, 0xb7, 
	0xb5, 0xb3, 0xb2, 0xb0, 
	0xaf, 0xad, 0xac, 0xaa, 
	0xa9, 0xa7, 0xa5, 0xa4, 
	0xa2, 0xa1, 0x9f, 0x9e, 
	0x9c, 0x9a, 0x99, 0x97, 
	0x96, 0x94, 0x93, 0x91, 
	0x90, 0x8e, 0x8c, 0x8b, 
	0x89, 0x88, 0x86, 0x85, 
	0x83, 0x81, 0x80, 0x7e, 
	0x7d, 0x7b, 0x7a, 0x78, 
	0x77, 0x75, 0x73, 0x72, 
	0x70, 0x6f, 0x6d, 0x6c, 
	0x6a, 0x68, 0x67, 0x65, 
	0x64, 0x62, 0x61, 0x5f,};

int r_b[64] ={
	0x5f0000, 0x650000, 0x6b0000, 0x720000, 
	0x780000, 0x7e0000, 0x840000, 0x8a0000, 
	0x900000, 0x960000, 0x9d0000, 0xa30000, 
	0xa90000, 0xaf0000, 0xb50000, 0xbb0000, 
	0xc10101, 0xc51111, 0xc92121, 0xcd3131, 
	0xd14141, 0xd55151, 0xd96161, 0xdd7171, 
	0xe08181, 0xe49191, 0xe8a1a1, 0xecb1b1, 
	0xf0c1c1, 0xf4d1d1, 0xf8e1e1, 0xfcf1f1, 
	0xfdfdff, 0xededfb, 0xddddf7, 0xcdcdf3, 
	0xbdbdef, 0xadadec, 0x9d9de8, 0x8d8de4, 
	0x7d7de0, 0x6d6ddc, 0x5d5dd9, 0x4d4dd5, 
	0x3d3dd1, 0x2d2dcd, 0x1d1dca, 0xd0dc6, 
	0xc2, 	  0xbb,     0xb5, 	  0xaf, 
	0xa9, 	  0xa2, 	0x9c, 	  0x96, 
	0x90, 	  0x89, 	0x83, 	  0x7d, 
	0x77, 	  0x70, 	0x6a, 	  0x64};

t_img	*init_image(t_env *e)
{
	t_img *img;

	img = (t_img*)malloc(sizeof(t_img));
	img->i_ptr = mlx_new_image(e->mlx, WIDTH, HEIGHT);
	img->bpp = 32;
	img->w = WIDTH;
	img->h = HEIGHT;
	img->size_line = WIDTH;
	img->endian = 0;
	img->data = mlx_get_data_addr(img->i_ptr, &img->bpp, &img->size_line, &img->endian);
	return (img);
}

t_env	*init_environment(void)
{
	t_env *e;

	e = (t_env*)malloc(sizeof(t_env));
	e->mlx = mlx_init();
	e->win = mlx_new_window(e->mlx, WIDTH, HEIGHT, "Fract'ol");
	e->img = init_image(e);
	e->zoom = 1;
	e->move_x = -0.5;
	e->move_y = 0;
	e->flags = 0;
	return (e);
}
int mandelbrot(t_env *e, float r, float c_a, float c_b)
{
	int n;
	float a;
	float o_a;
	float b;
	float o_b;
	

	
	n = 0;
	a = 0;
	b = 0;
	while (n < 100)
	{
		o_a = a * a - b * b;
		o_b = 2 * a * b;
		a = o_a + c_a;
		b = o_b + c_b;
		if (a * a + b * b > 4)
			break ;
		n++;
	}
	return (n);
	
}
void draw(t_env *e)
{
	int i;
	int j;
	int p;
	int ret;
	float c_a;
	float c_b;
	int color;
	float r;
	// char *i_data = e->img->data;
	

	r = sqrt(pow(WIDTH / 2, 2) + pow(HEIGHT / 2, 2));
	j = 0;
	p = 0;
	while (j < HEIGHT)
	{
		i = 0;
		while (i < WIDTH)
		{
			c_a = (2.5 * (i - WIDTH / 2) / (0.5 * WIDTH) + e->move_x) * 1 / e->zoom ;
			c_b = (2.5 * (j - HEIGHT / 2) / (0.5 * HEIGHT) + e->move_y) * 1 / e->zoom;
			if ((ret = mandelbrot(e, r, c_a, c_b)) == 100)
				color = 0;
			else
			{
				color = dawn[(int)((ret * 256 / 100) % 256)];
			}
			p = (i * 4) + (j * e->img->size_line);
			e->img->data[p] = color;
			e->img->data[++p] = color >> 8;
			e->img->data[++p] = color >> 16;
			i++;
		}
		j++;
	}
	e->img->data = mlx_get_data_addr(e->img->i_ptr, &e->img->bpp, &e->img->size_line, &e->img->endian);
	ft_printf("Image Data = %s\n", e->img->data);
	i = mlx_put_image_to_window(e->mlx, e->win, e->img->i_ptr, 0, 0);
	ft_printf("Put image return value = %d\n", i);
	mlx_destroy_image(e->mlx, e->img->i_ptr);
	e->img->i_ptr = mlx_new_image(e->mlx, WIDTH, HEIGHT);
}

int	main(void)
{
	t_env *e;
	e = init_environment();
	draw(e);
	my_loop(e);
	return (0);
}
